<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- | This module contains a compiler pass that associates top-level type</span><span>
</span><a name="line-2"></a><span class="hs-comment">--   signatures with the corresponding function declarations.</span><span>
</span><a name="line-3"></a><span class="hs-comment">--</span><span>
</span><a name="line-4"></a><span class="hs-comment">--   = Examples</span><span>
</span><a name="line-5"></a><span class="hs-comment">--</span><span>
</span><a name="line-6"></a><span class="hs-comment">--   == Example 1</span><span>
</span><a name="line-7"></a><span class="hs-comment">--</span><span>
</span><a name="line-8"></a><span class="hs-comment">--   For example, the following module that declares an unary function @null@</span><span>
</span><a name="line-9"></a><span class="hs-comment">--   with a type signature</span><span>
</span><a name="line-10"></a><span class="hs-comment">--</span><span>
</span><a name="line-11"></a><span class="hs-comment">--   &gt; null :: forall a. [a] -&gt; Bool</span><span>
</span><a name="line-12"></a><span class="hs-comment">--   &gt; null xs = case xs of { [] -&gt; True; x : xs' -&gt; False }</span><span>
</span><a name="line-13"></a><span class="hs-comment">--</span><span>
</span><a name="line-14"></a><span class="hs-comment">--   will be be converted to a module that still contains the type signature</span><span>
</span><a name="line-15"></a><span class="hs-comment">--   but the types of the argument @xs@ and the return type of @head@ are</span><span>
</span><a name="line-16"></a><span class="hs-comment">--   also annotated explicitly in the function declaration itself.</span><span>
</span><a name="line-17"></a><span class="hs-comment">--   In addition, the type arguments of the type scheme are copied from the type</span><span>
</span><a name="line-18"></a><span class="hs-comment">--   signature to the function declaration's type argument list.</span><span>
</span><a name="line-19"></a><span class="hs-comment">--</span><span>
</span><a name="line-20"></a><span class="hs-comment">--   &gt; null :: forall a. [a] -&gt; Bool</span><span>
</span><a name="line-21"></a><span class="hs-comment">--   &gt; null @a (xs :: [a]) :: Bool = case xs of {</span><span>
</span><a name="line-22"></a><span class="hs-comment">--   &gt;     []      -&gt; True;</span><span>
</span><a name="line-23"></a><span class="hs-comment">--   &gt;     x : xs' -&gt; False</span><span>
</span><a name="line-24"></a><span class="hs-comment">--   &gt;   }</span><span>
</span><a name="line-25"></a><span class="hs-comment">--</span><span>
</span><a name="line-26"></a><span class="hs-comment">--   == Example 2</span><span>
</span><a name="line-27"></a><span class="hs-comment">--</span><span>
</span><a name="line-28"></a><span class="hs-comment">--   The type signature of an @n@-ary function declaration must not necessarily</span><span>
</span><a name="line-29"></a><span class="hs-comment">--   be a function type with @n-1@ arrows. For example, the type signature</span><span>
</span><a name="line-30"></a><span class="hs-comment">--   could contain type synonyms.</span><span>
</span><a name="line-31"></a><span class="hs-comment">--</span><span>
</span><a name="line-32"></a><span class="hs-comment">--   &gt; type Subst = String -&gt; Expr</span><span>
</span><a name="line-33"></a><span class="hs-comment">--   &gt;</span><span>
</span><a name="line-34"></a><span class="hs-comment">--   &gt; identity :: Subst</span><span>
</span><a name="line-35"></a><span class="hs-comment">--   &gt; identity x = Var x</span><span>
</span><a name="line-36"></a><span class="hs-comment">--</span><span>
</span><a name="line-37"></a><span class="hs-comment">--   In this case, the type synonym needs to be expanded in order to determine</span><span>
</span><a name="line-38"></a><span class="hs-comment">--   the type of the argument @x@ and the return type of @identity@.</span><span>
</span><a name="line-39"></a><span class="hs-comment">--</span><span>
</span><a name="line-40"></a><span class="hs-comment">--   &gt; type Subst = String -&gt; Expr</span><span>
</span><a name="line-41"></a><span class="hs-comment">--   &gt;</span><span>
</span><a name="line-42"></a><span class="hs-comment">--   &gt; identity :: Subst</span><span>
</span><a name="line-43"></a><span class="hs-comment">--   &gt; identity (x :: String) :: Expr = Var x</span><span>
</span><a name="line-44"></a><span class="hs-comment">--</span><span>
</span><a name="line-45"></a><span class="hs-comment">--   The original type signature is left unchanged (not expanded) and type</span><span>
</span><a name="line-46"></a><span class="hs-comment">--   synonyms are only expanded when necessary.</span><span>
</span><a name="line-47"></a><span class="hs-comment">--</span><span>
</span><a name="line-48"></a><span class="hs-comment">--   = Specification</span><span>
</span><a name="line-49"></a><span class="hs-comment">--</span><span>
</span><a name="line-50"></a><span class="hs-comment">--   == Preconditions</span><span>
</span><a name="line-51"></a><span class="hs-comment">--</span><span>
</span><a name="line-52"></a><span class="hs-comment">--   The environment contains entries for all type synonyms.</span><span>
</span><a name="line-53"></a><span class="hs-comment">--   Otherwise this pass fails if a type synonym needs to be expanded to</span><span>
</span><a name="line-54"></a><span class="hs-comment">--   determine the type of an argument.</span><span>
</span><a name="line-55"></a><span class="hs-comment">--</span><span>
</span><a name="line-56"></a><span class="hs-comment">--   == Translation</span><span>
</span><a name="line-57"></a><span class="hs-comment">--</span><span>
</span><a name="line-58"></a><span class="hs-comment">--   The declaration of every @n@-ary function @f@</span><span>
</span><a name="line-59"></a><span class="hs-comment">--</span><span>
</span><a name="line-60"></a><span class="hs-comment">--   &gt; f x&#8321; &#8230; x&#8345; = e</span><span>
</span><a name="line-61"></a><span class="hs-comment">--</span><span>
</span><a name="line-62"></a><span class="hs-comment">--   for which there exists a top-level type signature</span><span>
</span><a name="line-63"></a><span class="hs-comment">--</span><span>
</span><a name="line-64"></a><span class="hs-comment">--   &gt; &#8230;, f, &#8230; :: forall &#945;&#8321; &#8230; &#945;&#8344;. &#964;</span><span>
</span><a name="line-65"></a><span class="hs-comment">--</span><span>
</span><a name="line-66"></a><span class="hs-comment">--   will be converted into a function declaration with explicit type</span><span>
</span><a name="line-67"></a><span class="hs-comment">--   annotations and type arguments</span><span>
</span><a name="line-68"></a><span class="hs-comment">--</span><span>
</span><a name="line-69"></a><span class="hs-comment">--   &gt; f @&#945;&#8321; &#8230; @&#945;&#8344; (x&#8321; :: &#964;&#8321;) &#8230; (x&#8345; :: &#964;&#8345;) :: &#964;' = e</span><span>
</span><a name="line-70"></a><span class="hs-comment">--</span><span>
</span><a name="line-71"></a><span class="hs-comment">--   where @&#964;&#8321; -&gt; &#8230; -&gt; &#964;&#8345; -&gt; &#964;@ is the smallest type that can be derived</span><span>
</span><a name="line-72"></a><span class="hs-comment">--   from @&#964;@ by expanding type synonyms.</span><span>
</span><a name="line-73"></a><span class="hs-comment">--</span><span>
</span><a name="line-74"></a><span class="hs-comment">--   == Postconditions</span><span>
</span><a name="line-75"></a><span class="hs-comment">--</span><span>
</span><a name="line-76"></a><span class="hs-comment">--   The argument and return types of every function declaration that has a</span><span>
</span><a name="line-77"></a><span class="hs-comment">--   top-level type signature are annotated explicitly.</span><span>
</span><a name="line-78"></a><span class="hs-comment">--</span><span>
</span><a name="line-79"></a><span class="hs-comment">--   == Error cases</span><span>
</span><a name="line-80"></a><span class="hs-comment">--</span><span>
</span><a name="line-81"></a><span class="hs-comment">--   * A fatal error is reported if the type of an argument cannot be</span><span>
</span><a name="line-82"></a><span class="hs-comment">--     determined because a type synonym could not be expanded.</span><span>
</span><a name="line-83"></a><span class="hs-comment">--   * A fatal error is reported if there are multiple type signatures for the</span><span>
</span><a name="line-84"></a><span class="hs-comment">--     same function declaration.</span><span>
</span><a name="line-85"></a><span class="hs-comment">--   * A warning is reported if there is a type signature without accompanying</span><span>
</span><a name="line-86"></a><span class="hs-comment">--     function declaration.</span><span>
</span><a name="line-87"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">FreeC.Pass.TypeSignaturePass</span><span>
</span><a name="line-88"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#typeSignaturePass"><span class="hs-identifier hs-var">typeSignaturePass</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-comment">-- * Definitions Reused in the @EtaConversionPass@</span><span>
</span><a name="line-90"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#splitFuncType"><span class="hs-identifier hs-var">splitFuncType</span></a><span>
</span><a name="line-91"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-92"></a><span>
</span><a name="line-93"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Control.Monad</span><span>             </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">when</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.List</span><span>                 </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-95"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Map.Strict</span><span>           </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map.Strict</span><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-97"></a><span class="hs-keyword">import</span><span>           </span><span class="hs-identifier">Data.Set</span><span>                  </span><span class="hs-special">(</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Set</span><span>                  </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Set</span><span>
</span><a name="line-99"></a><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.IR.SrcSpan.html"><span class="hs-identifier">FreeC.IR.SrcSpan</span></a><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="FreeC.IR.Syntax.html"><span class="hs-identifier">FreeC.IR.Syntax</span></a><span>           </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">IR</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.IR.TypeSynExpansion.html"><span class="hs-identifier">FreeC.IR.TypeSynExpansion</span></a><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.Monad.Converter.html"><span class="hs-identifier">FreeC.Monad.Converter</span></a><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.Monad.Reporter.html"><span class="hs-identifier">FreeC.Monad.Reporter</span></a><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.Pass.html"><span class="hs-identifier">FreeC.Pass</span></a><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span>           </span><a href="FreeC.Pretty.html"><span class="hs-identifier">FreeC.Pretty</span></a><span>
</span><a name="line-107"></a><span>
</span><a name="line-108"></a><span class="hs-comment">-- | Associates top-level type signatures with the corresponding function</span><span>
</span><a name="line-109"></a><span class="hs-comment">--   declarations in the given module.</span><span>
</span><a name="line-110"></a><span class="hs-identifier">typeSignaturePass</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.Pass.html#Pass"><span class="hs-identifier hs-type">Pass</span></a><span> </span><a href="FreeC.IR.Syntax.Module.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a><span> </span><a href="FreeC.IR.Syntax.Module.html#Module"><span class="hs-identifier hs-type">IR.Module</span></a><span>
</span><a name="line-111"></a><a name="typeSignaturePass"><a href="FreeC.Pass.TypeSignaturePass.html#typeSignaturePass"><span class="hs-identifier">typeSignaturePass</span></a></a><span> </span><a name="local-6989586621679254872"><a href="#local-6989586621679254872"><span class="hs-identifier">ast</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679254873"><a href="#local-6989586621679254873"><span class="hs-identifier">typeSigs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">IR.modTypeSigs</span><span> </span><a href="#local-6989586621679254872"><span class="hs-identifier hs-var">ast</span></a><span>
</span><a name="line-113"></a><span>      </span><a name="local-6989586621679254874"><a href="#local-6989586621679254874"><span class="hs-identifier">funcDecls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">IR.modFuncDecls</span><span> </span><a href="#local-6989586621679254872"><span class="hs-identifier hs-var">ast</span></a><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier hs-var">mapM_</span><span> </span><span class="hs-special">(</span><a href="FreeC.Pass.TypeSignaturePass.html#checkHasBinding"><span class="hs-identifier hs-var">checkHasBinding</span></a><span> </span><a href="#local-6989586621679254874"><span class="hs-identifier hs-var">funcDecls</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679254873"><span class="hs-identifier hs-var">typeSigs</span></a><span>
</span><a name="line-115"></a><span>  </span><a name="local-6989586621679254875"><a href="#local-6989586621679254875"><span class="hs-identifier">funcDecls'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#addTypeSigsToFuncDecls"><span class="hs-identifier hs-var">addTypeSigsToFuncDecls</span></a><span> </span><a href="#local-6989586621679254873"><span class="hs-identifier hs-var">typeSigs</span></a><span> </span><a href="#local-6989586621679254874"><span class="hs-identifier hs-var">funcDecls</span></a><span>
</span><a name="line-116"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679254872"><span class="hs-identifier hs-var">ast</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">IR.modFuncDecls</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679254875"><span class="hs-identifier hs-var">funcDecls'</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-119"></a><span class="hs-comment">-- Checks                                                                    --</span><span>
</span><a name="line-120"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-121"></a><span class="hs-comment">-- | Checks whether there is a function declaration for all functions</span><span>
</span><a name="line-122"></a><span class="hs-comment">--   annotated by the given type signature.</span><span>
</span><a name="line-123"></a><span class="hs-comment">--</span><span>
</span><a name="line-124"></a><span class="hs-comment">--   Reports a warning is there is a type signature without accompanying</span><span>
</span><a name="line-125"></a><span class="hs-comment">--   function declaration.</span><span>
</span><a name="line-126"></a><span class="hs-identifier">checkHasBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.FuncDecl.html#FuncDecl"><span class="hs-identifier hs-type">IR.FuncDecl</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#TypeSig"><span class="hs-identifier hs-type">IR.TypeSig</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><a name="checkHasBinding"><a href="FreeC.Pass.TypeSignaturePass.html#checkHasBinding"><span class="hs-identifier">checkHasBinding</span></a></a><span> </span><a name="local-6989586621679254876"><a href="#local-6989586621679254876"><span class="hs-identifier">funcDecls</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM_</span><span> </span><a href="#local-6989586621679254878"><span class="hs-identifier hs-var">checkHasBinding'</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">IR.typeSigDeclIdents</span><span>
</span><a name="line-128"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-comment">-- | The names of all declared functions.</span><span>
</span><a name="line-130"></a><span>  </span><span class="hs-identifier">funcDeclNames</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Set</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span>
</span><a name="line-131"></a><span>  </span><a name="local-6989586621679254877"><a href="#local-6989586621679254877"><span class="hs-identifier">funcDeclNames</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Set.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#funcDeclQName"><span class="hs-identifier hs-var">IR.funcDeclQName</span></a><span> </span><a href="#local-6989586621679254876"><span class="hs-identifier hs-var">funcDecls</span></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span>  </span><span class="hs-comment">-- | Checks whether there is a function declaration for the function</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-comment">--   with the given name.</span><span>
</span><a name="line-135"></a><span>  </span><span class="hs-identifier">checkHasBinding'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.IR.Syntax.Name.html#DeclIdent"><span class="hs-identifier hs-type">IR.DeclIdent</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-136"></a><span>  </span><a name="local-6989586621679254878"><a href="#local-6989586621679254878"><span class="hs-identifier">checkHasBinding'</span></a></a><span> </span><span class="hs-special">(</span><a href="FreeC.IR.Syntax.Name.html#DeclIdent"><span class="hs-identifier hs-var">IR.DeclIdent</span></a><span> </span><a name="local-6989586621679254879"><a href="#local-6989586621679254879"><span class="hs-identifier">srcSpan</span></a></a><span> </span><a name="local-6989586621679254880"><a href="#local-6989586621679254880"><span class="hs-identifier">name</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">when</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">(</span><a href="#local-6989586621679254880"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">Set.notMember</span><span class="hs-special">`</span><span> </span><a href="#local-6989586621679254877"><span class="hs-identifier hs-var">funcDeclNames</span></a><span class="hs-special">)</span><span>
</span><a name="line-138"></a><span>    </span><span class="hs-operator hs-var">$</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#reportMissingBinding"><span class="hs-identifier hs-var">reportMissingBinding</span></a><span> </span><a href="#local-6989586621679254879"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="#local-6989586621679254880"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- Translation                                                               --</span><span>
</span><a name="line-142"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- | Annotates the given function declarations with the type from the</span><span>
</span><a name="line-144"></a><span class="hs-comment">--   corresponding type signature.</span><span>
</span><a name="line-145"></a><span class="hs-comment">--</span><span>
</span><a name="line-146"></a><span class="hs-comment">--   Reports a fatal error if the type of an argument cannot be inferred from</span><span>
</span><a name="line-147"></a><span class="hs-comment">--   the type signature (see 'splitFuncType') or there are multiple type</span><span>
</span><a name="line-148"></a><span class="hs-comment">--   signatures for the same function.</span><span>
</span><a name="line-149"></a><span class="hs-identifier">addTypeSigsToFuncDecls</span><span>
</span><a name="line-150"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.FuncDecl.html#TypeSig"><span class="hs-identifier hs-type">IR.TypeSig</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.FuncDecl.html#FuncDecl"><span class="hs-identifier hs-type">IR.FuncDecl</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.FuncDecl.html#FuncDecl"><span class="hs-identifier hs-type">IR.FuncDecl</span></a><span class="hs-special">]</span><span>
</span><a name="line-151"></a><a name="addTypeSigsToFuncDecls"><a href="FreeC.Pass.TypeSignaturePass.html#addTypeSigsToFuncDecls"><span class="hs-identifier">addTypeSigsToFuncDecls</span></a></a><span> </span><a name="local-6989586621679254881"><a href="#local-6989586621679254881"><span class="hs-identifier">typeSigs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mapM</span><span> </span><a href="#local-6989586621679254884"><span class="hs-identifier hs-var">addTypeSigToFuncDecl</span></a><span>
</span><a name="line-152"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-153"></a><span>  </span><span class="hs-comment">-- | Maps the names of functions to their annotated type.</span><span>
</span><a name="line-154"></a><span>  </span><span class="hs-identifier">typeSigMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.TypeScheme.html#TypeScheme"><span class="hs-identifier hs-type">IR.TypeScheme</span></a><span class="hs-special">]</span><span>
</span><a name="line-155"></a><span>  </span><a name="local-6989586621679254882"><a href="#local-6989586621679254882"><span class="hs-identifier">typeSigMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromListWith</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">++</span><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="#local-6989586621679254887"><span class="hs-identifier hs-var">name</span></a><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679254886"><span class="hs-identifier hs-var">typeScheme</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#TypeSig"><span class="hs-identifier hs-var">IR.TypeSig</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679254885"><a href="#local-6989586621679254885"><span class="hs-identifier">declIdents</span></a></a><span> </span><a name="local-6989586621679254886"><a href="#local-6989586621679254886"><span class="hs-identifier">typeScheme</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679254881"><span class="hs-identifier hs-var">typeSigs</span></a><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="FreeC.IR.Syntax.Name.html#DeclIdent"><span class="hs-identifier hs-var">IR.DeclIdent</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679254887"><a href="#local-6989586621679254887"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679254885"><span class="hs-identifier hs-var">declIdents</span></a><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">]</span><span>
</span><a name="line-160"></a><span>
</span><a name="line-161"></a><span>  </span><span class="hs-comment">-- | Sets the type annotation of the given variable pattern.</span><span>
</span><a name="line-162"></a><span>  </span><span class="hs-identifier">setVarPatType</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.IR.Syntax.Expr.html#VarPat"><span class="hs-identifier hs-type">IR.VarPat</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Expr.html#VarPat"><span class="hs-identifier hs-type">IR.VarPat</span></a><span>
</span><a name="line-163"></a><span>  </span><a name="local-6989586621679254883"><a href="#local-6989586621679254883"><span class="hs-identifier">setVarPatType</span></a></a><span> </span><a name="local-6989586621679254888"><a href="#local-6989586621679254888"><span class="hs-identifier">arg</span></a></a><span> </span><a name="local-6989586621679254889"><a href="#local-6989586621679254889"><span class="hs-identifier">argType</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679254888"><span class="hs-identifier hs-var">arg</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">IR.varPatType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679254889"><span class="hs-identifier hs-var">argType</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>  </span><span class="hs-comment">-- | Annotates the given function declaration with the type from the</span><span>
</span><a name="line-166"></a><span>  </span><span class="hs-comment">--   corresponding type signature.</span><span>
</span><a name="line-167"></a><span>  </span><span class="hs-identifier">addTypeSigToFuncDecl</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#FuncDecl"><span class="hs-identifier hs-type">IR.FuncDecl</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#FuncDecl"><span class="hs-identifier hs-type">IR.FuncDecl</span></a><span>
</span><a name="line-168"></a><span>  </span><a name="local-6989586621679254884"><a href="#local-6989586621679254884"><span class="hs-identifier">addTypeSigToFuncDecl</span></a></a><span> </span><a name="local-6989586621679254890"><a href="#local-6989586621679254890"><span class="hs-identifier">funcDecl</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679254891"><a href="#local-6989586621679254891"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FreeC.IR.Syntax.FuncDecl.html#funcDeclQName"><span class="hs-identifier hs-var">IR.funcDeclQName</span></a><span> </span><a href="#local-6989586621679254890"><span class="hs-identifier hs-var">funcDecl</span></a><span>
</span><a name="line-170"></a><span>        </span><a name="local-6989586621679254892"><a href="#local-6989586621679254892"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">IR.funcDeclArgs</span><span> </span><a href="#local-6989586621679254890"><span class="hs-identifier hs-var">funcDecl</span></a><span>
</span><a name="line-171"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier hs-var">Map.lookup</span><span> </span><a href="#local-6989586621679254891"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679254882"><span class="hs-identifier hs-var">typeSigMap</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-172"></a><span>      </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679254890"><span class="hs-identifier hs-var">funcDecl</span></a><span>
</span><a name="line-173"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.TypeScheme.html#TypeScheme"><span class="hs-identifier hs-var">IR.TypeScheme</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679254893"><a href="#local-6989586621679254893"><span class="hs-identifier">typeArgs</span></a></a><span> </span><a name="local-6989586621679254894"><a href="#local-6989586621679254894"><span class="hs-identifier">typeExpr</span></a></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-174"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679254895"><a href="#local-6989586621679254895"><span class="hs-identifier">argTypes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679254896"><a href="#local-6989586621679254896"><span class="hs-identifier">retType</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#splitFuncType"><span class="hs-identifier hs-var">splitFuncType</span></a><span> </span><a href="#local-6989586621679254891"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679254892"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679254894"><span class="hs-identifier hs-var">typeExpr</span></a><span>
</span><a name="line-175"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679254890"><span class="hs-identifier hs-var">funcDecl</span></a><span>
</span><a name="line-176"></a><span>          </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">IR.funcDeclTypeArgs</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679254893"><span class="hs-identifier hs-var">typeArgs</span></a><span>
</span><a name="line-177"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IR.funcDeclArgs</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">zipWith</span><span> </span><a href="#local-6989586621679254883"><span class="hs-identifier hs-var">setVarPatType</span></a><span> </span><a href="#local-6989586621679254892"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679254895"><span class="hs-identifier hs-var">argTypes</span></a><span>
</span><a name="line-178"></a><span>          </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IR.funcDeclReturnType</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679254896"><span class="hs-identifier hs-var">retType</span></a><span>
</span><a name="line-179"></a><span>          </span><span class="hs-special">}</span><span>
</span><a name="line-180"></a><span>      </span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679254897"><a href="#local-6989586621679254897"><span class="hs-identifier">typeSchemes</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#reportDuplicateTypeSigs"><span class="hs-identifier hs-var">reportDuplicateTypeSigs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">IR.funcDeclSrcSpan</span><span> </span><a href="#local-6989586621679254890"><span class="hs-identifier hs-var">funcDecl</span></a><span class="hs-special">)</span><span>
</span><a name="line-181"></a><span>        </span><a href="#local-6989586621679254891"><span class="hs-identifier hs-var">name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier">IR.typeSchemeSrcSpan</span><span> </span><a href="#local-6989586621679254897"><span class="hs-identifier hs-var">typeSchemes</span></a><span class="hs-special">)</span><span>
</span><a name="line-182"></a><span>
</span><a name="line-183"></a><span class="hs-comment">-- | Splits the annotated type of a Haskell function with the given arguments</span><span>
</span><a name="line-184"></a><span class="hs-comment">--   into its argument and return types.</span><span>
</span><a name="line-185"></a><span class="hs-comment">--</span><span>
</span><a name="line-186"></a><span class="hs-comment">--   Type synonyms are expanded if necessary. Reports a fatal error if a type</span><span>
</span><a name="line-187"></a><span class="hs-comment">--   synonym could not be expanded.</span><span>
</span><a name="line-188"></a><span class="hs-identifier">splitFuncType</span><span>
</span><a name="line-189"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span>    </span><span class="hs-comment">-- ^ The name of the function to display in error messages.</span><span>
</span><a name="line-190"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.Expr.html#VarPat"><span class="hs-identifier hs-type">IR.VarPat</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The argument variable patterns whose types to split of.</span><span>
</span><a name="line-191"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span>     </span><span class="hs-comment">-- ^ The type to split.</span><span>
</span><a name="line-192"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><a name="splitFuncType"><a href="FreeC.Pass.TypeSignaturePass.html#splitFuncType"><span class="hs-identifier">splitFuncType</span></a></a><span> </span><a name="local-6989586621679254898"><a href="#local-6989586621679254898"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679254899"><span class="hs-identifier hs-var">splitFuncType'</span></a><span>
</span><a name="line-194"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-195"></a><span>  </span><span class="hs-identifier">splitFuncType'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.Expr.html#VarPat"><span class="hs-identifier hs-type">IR.VarPat</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.Monad.Converter.html#Converter"><span class="hs-identifier hs-type">Converter</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="FreeC.IR.Syntax.Type.html#Type"><span class="hs-identifier hs-type">IR.Type</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>  </span><a name="local-6989586621679254899"><a href="#local-6989586621679254899"><span class="hs-identifier">splitFuncType'</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><a name="local-6989586621679254900"><a href="#local-6989586621679254900"><span class="hs-identifier">typeExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679254900"><span class="hs-identifier hs-var">typeExpr</span></a><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>  </span><span class="hs-identifier">splitFuncType'</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679254901"><a href="#local-6989586621679254901"><span class="hs-identifier">args</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="FreeC.IR.Syntax.Type.html#FuncType"><span class="hs-identifier hs-var">IR.FuncType</span></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679254902"><a href="#local-6989586621679254902"><span class="hs-identifier">t1</span></a></a><span> </span><a name="local-6989586621679254903"><a href="#local-6989586621679254903"><span class="hs-identifier">t2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679254904"><a href="#local-6989586621679254904"><span class="hs-identifier">argTypes</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679254905"><a href="#local-6989586621679254905"><span class="hs-identifier">returnType</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679254899"><span class="hs-identifier hs-var">splitFuncType'</span></a><span> </span><a href="#local-6989586621679254901"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679254903"><span class="hs-identifier hs-var">t2</span></a><span>
</span><a name="line-199"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679254902"><span class="hs-identifier hs-var">t1</span></a><span> </span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679254904"><span class="hs-identifier hs-var">argTypes</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679254905"><span class="hs-identifier hs-var">returnType</span></a><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>  </span><span class="hs-identifier">splitFuncType'</span><span> </span><a name="local-6989586621679254906"><a href="#local-6989586621679254906"><span class="hs-identifier">args</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679254907"><a href="#local-6989586621679254907"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679254908"><a href="#local-6989586621679254908"><span class="hs-identifier">typeExpr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-201"></a><span>    </span><a name="local-6989586621679254909"><a href="#local-6989586621679254909"><span class="hs-identifier">typeExpr'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="FreeC.IR.TypeSynExpansion.html#expandTypeSynonym"><span class="hs-identifier hs-var">expandTypeSynonym</span></a><span> </span><a href="#local-6989586621679254908"><span class="hs-identifier hs-var">typeExpr</span></a><span>
</span><a name="line-202"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679254908"><span class="hs-identifier hs-var">typeExpr</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679254909"><span class="hs-identifier hs-var">typeExpr'</span></a><span>
</span><a name="line-203"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="FreeC.Pass.TypeSignaturePass.html#reportTypeSynExpansionError"><span class="hs-identifier hs-var">reportTypeSynExpansionError</span></a><span> </span><a href="#local-6989586621679254898"><span class="hs-identifier hs-var">name</span></a><span> </span><a href="#local-6989586621679254907"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-204"></a><span>      </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679254899"><span class="hs-identifier hs-var">splitFuncType'</span></a><span> </span><a href="#local-6989586621679254906"><span class="hs-identifier hs-var">args</span></a><span> </span><a href="#local-6989586621679254909"><span class="hs-identifier hs-var">typeExpr'</span></a><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-207"></a><span class="hs-comment">-- Error Messages                                                            --</span><span>
</span><a name="line-208"></a><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><a name="line-209"></a><span class="hs-comment">-- | Warns the user that there is no function declaration for the type</span><span>
</span><a name="line-210"></a><span class="hs-comment">--   signature of the function with the given name.</span><span>
</span><a name="line-211"></a><span class="hs-identifier">reportMissingBinding</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.Monad.Reporter.html#MonadReporter"><span class="hs-identifier hs-type">MonadReporter</span></a><span> </span><a href="#local-6989586621679254871"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-212"></a><span>                     </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FreeC.IR.SrcSpan.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>  </span><span class="hs-comment">-- ^ The location of the type signature.</span><span>
</span><a name="line-213"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span> </span><span class="hs-comment">-- ^ The name of the function.</span><span>
</span><a name="line-214"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679254871"><span class="hs-identifier hs-type">r</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-215"></a><a name="reportMissingBinding"><a href="FreeC.Pass.TypeSignaturePass.html#reportMissingBinding"><span class="hs-identifier">reportMissingBinding</span></a></a><span> </span><a name="local-6989586621679254910"><a href="#local-6989586621679254910"><span class="hs-identifier">srcSpan</span></a></a><span> </span><a name="local-6989586621679254911"><a href="#local-6989586621679254911"><span class="hs-identifier">name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FreeC.Monad.Reporter.html#report"><span class="hs-identifier hs-var">report</span></a><span>
</span><a name="line-216"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="FreeC.Monad.Reporter.html#Message"><span class="hs-identifier hs-var">Message</span></a><span> </span><a href="#local-6989586621679254910"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="FreeC.Monad.Reporter.html#Warning"><span class="hs-identifier hs-var">Warning</span></a><span>
</span><a name="line-217"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;The type signature for '&quot;</span><span>
</span><a name="line-218"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="FreeC.Pretty.html#showPretty"><span class="hs-identifier hs-var">showPretty</span></a><span> </span><a href="#local-6989586621679254911"><span class="hs-identifier hs-var">name</span></a><span>
</span><a name="line-219"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' lacks an accompanying binding.&quot;</span><span>
</span><a name="line-220"></a><span>
</span><a name="line-221"></a><span class="hs-comment">-- | Reports a fatal error if there are multiple type signatures for the</span><span>
</span><a name="line-222"></a><span class="hs-comment">--   same function declaration.</span><span>
</span><a name="line-223"></a><span class="hs-identifier">reportDuplicateTypeSigs</span><span>
</span><a name="line-224"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.Monad.Reporter.html#MonadReporter"><span class="hs-identifier hs-type">MonadReporter</span></a><span> </span><a href="#local-6989586621679254869"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-225"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FreeC.IR.SrcSpan.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span>   </span><span class="hs-comment">-- ^ The location of the function declaration.</span><span>
</span><a name="line-226"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span>  </span><span class="hs-comment">-- ^ The name of the function.</span><span>
</span><a name="line-227"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="FreeC.IR.SrcSpan.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The locations of the type signatures.</span><span>
</span><a name="line-228"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679254869"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679254870"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-229"></a><a name="reportDuplicateTypeSigs"><a href="FreeC.Pass.TypeSignaturePass.html#reportDuplicateTypeSigs"><span class="hs-identifier">reportDuplicateTypeSigs</span></a></a><span> </span><a name="local-6989586621679254912"><a href="#local-6989586621679254912"><span class="hs-identifier">srcSpan</span></a></a><span> </span><a name="local-6989586621679254913"><a href="#local-6989586621679254913"><span class="hs-identifier">funcName</span></a></a><span> </span><a name="local-6989586621679254914"><a href="#local-6989586621679254914"><span class="hs-identifier">typeSigSrcSpans</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FreeC.Monad.Reporter.html#reportFatal"><span class="hs-identifier hs-var">reportFatal</span></a><span>
</span><a name="line-230"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="FreeC.Monad.Reporter.html#Message"><span class="hs-identifier hs-var">Message</span></a><span> </span><a href="#local-6989586621679254912"><span class="hs-identifier hs-var">srcSpan</span></a><span> </span><a href="FreeC.Monad.Reporter.html#Error"><span class="hs-identifier hs-var">Error</span></a><span>
</span><a name="line-231"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Duplicate type signatures for '&quot;</span><span>
</span><a name="line-232"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="FreeC.Pretty.html#showPretty"><span class="hs-identifier hs-var">showPretty</span></a><span> </span><a href="#local-6989586621679254913"><span class="hs-identifier hs-var">funcName</span></a><span>
</span><a name="line-233"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' at &quot;</span><span>
</span><a name="line-234"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">intercalate</span><span> </span><span class="hs-string">&quot;, &quot;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="FreeC.Pretty.html#showPretty"><span class="hs-identifier hs-var">showPretty</span></a><span> </span><a href="#local-6989586621679254914"><span class="hs-identifier hs-var">typeSigSrcSpans</span></a><span class="hs-special">)</span><span>
</span><a name="line-235"></a><span>
</span><a name="line-236"></a><span class="hs-comment">-- | Reports a fatal error if the type of a function argument cannot be</span><span>
</span><a name="line-237"></a><span class="hs-comment">--   determined by expanding a type synonyms from its type signature.</span><span>
</span><a name="line-238"></a><span class="hs-identifier">reportTypeSynExpansionError</span><span>
</span><a name="line-239"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="FreeC.Monad.Reporter.html#MonadReporter"><span class="hs-identifier hs-type">MonadReporter</span></a><span> </span><a href="#local-6989586621679254867"><span class="hs-identifier hs-type">r</span></a><span>
</span><a name="line-240"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="FreeC.IR.Syntax.Name.html#QName"><span class="hs-identifier hs-type">IR.QName</span></a><span>  </span><span class="hs-comment">-- ^ The name of the function.</span><span>
</span><a name="line-241"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="FreeC.IR.Syntax.Expr.html#VarPat"><span class="hs-identifier hs-type">IR.VarPat</span></a><span> </span><span class="hs-comment">-- ^ The argument whose argument type could not be determined.</span><span>
</span><a name="line-242"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679254867"><span class="hs-identifier hs-type">r</span></a><span> </span><a href="#local-6989586621679254868"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-243"></a><a name="reportTypeSynExpansionError"><a href="FreeC.Pass.TypeSignaturePass.html#reportTypeSynExpansionError"><span class="hs-identifier">reportTypeSynExpansionError</span></a></a><span> </span><a name="local-6989586621679254915"><a href="#local-6989586621679254915"><span class="hs-identifier">funcName</span></a></a><span> </span><a name="local-6989586621679254916"><a href="#local-6989586621679254916"><span class="hs-identifier">arg</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="FreeC.Monad.Reporter.html#reportFatal"><span class="hs-identifier hs-var">reportFatal</span></a><span>
</span><a name="line-244"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><a href="FreeC.Monad.Reporter.html#Message"><span class="hs-identifier hs-var">Message</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">IR.varPatSrcSpan</span><span> </span><a href="#local-6989586621679254916"><span class="hs-identifier hs-var">arg</span></a><span class="hs-special">)</span><span> </span><a href="FreeC.Monad.Reporter.html#Error"><span class="hs-identifier hs-var">Error</span></a><span>
</span><a name="line-245"></a><span>  </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-string">&quot;Could not determine type of argument '&quot;</span><span>
</span><a name="line-246"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier">IR.varPatIdent</span><span> </span><a href="#local-6989586621679254916"><span class="hs-identifier hs-var">arg</span></a><span>
</span><a name="line-247"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;' for function '&quot;</span><span>
</span><a name="line-248"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><a href="FreeC.Pretty.html#showPretty"><span class="hs-identifier hs-var">showPretty</span></a><span> </span><a href="#local-6989586621679254915"><span class="hs-identifier hs-var">funcName</span></a><span>
</span><a name="line-249"></a><span>  </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;'.&quot;</span><span>
</span><a name="line-250"></a></pre></body></html>